<!doctype html>
<html lang="en">

<head>
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type">
    <meta content="TiddlyWiki5 CPL" name="application-name">
    <meta content="v5.2.0" name="application-version">
    <meta content="Copyright 2015 Jeremy Ruston" name="copyright">
    <link href="favicon.ico" id="faviconLink" rel="shortcut icon">
    <title>TiddlyWiki5 CPL</title>
    <script>
        var assetList = [{"tags":"$:/tags/PluginWiki","title":"$:/plugins/Gk0Wk/TW5-CodeMirror-Enhanced","version":"0.1.1","author":"Gk0Wk","description":"TiddlyWiki5 highlighting mode for CodeMirror.","dependents":"$:/plugins/tiddlywiki/codemirror\n$:/plugins/tiddlywiki/codemirror-autocomplete","sourse":"https://github.com/Gk0Wk/TW5-CodeMirror-Enhanced","documentation":"https://gk0wk.github.io/TW5-CodeMirror-Enhanced","name":"TW5-CodeMirror-Enhanced","requires-reload":"yes","readme":"<$list filter=\"[[$:/language]get[text]removeprefix[$:/languages/]else[en-GB]]\" variable=\"lang\">\n<$list filter=\"[<lang>search[zh]]\">\n\n如想了解更多，请关注我们的[[GitHub Repo|https://github.com/Gk0Wk/TW5-CodeMirror-Enhanced]]。\n\n为TiddlyWiki的CodeMirror编辑器提供一个灵活而丰富的扩展框架(包括高亮、补全、预览等功能)，任何人都可以使用此框架为编辑器编写扩展插件！目前基于此框架实现的功能有：\n\n* TiddlyWiki5(`text/vnd.tiddlywiki`)语法高亮；\n* Wiki链接自动提示；\n* Tiddler预览；\n* 可点击链接；\n\n更多功能正在开发中，欢迎你的加入！\n</$list>\n\n<$list filter=\"[<lang>!search[zh]]\">\n\nView more on [[GitHub Repo|https://github.com/Gk0Wk/TW5-CodeMirror-Enhanced]].\n\nCodeMirror editor for TiddlyWiki provides a flexible and rich extension framework (including highlighting, completion, preview and other features), anyone can use this framework to write extension plug-ins for the editor! Currently based on this framework to achieve the following features.\n\n* TiddlyWiki5 (`text/vnd.tiddlywiki`) syntax highlighting.\n* Wiki link auto-tip;\n* Tiddler preview;\n* Clickable links.\n\nMore features are in development, welcome to join!\n</$list>\n</$list>","plugin-type":"plugin"}];
        ! function() {
            "use strict";

            // Listen for window messages
            window.addEventListener("message", function listener(event) {
                console.log("plugin library: Received message from", event.origin);
                console.log("plugin library: Message content", event.data);
                switch (event.data.verb) {
                    case "GET":
                        if (event.data.url === "recipes/library/tiddlers.json") {
                            // Route for recipes/library/tiddlers.json
                            event.source.postMessage({
                                verb: "GET-RESPONSE",
                                status: "200",
                                cookies: event.data.cookies,
                                url: event.data.url,
                                type: "application/json",
                                body: JSON.stringify(assetList, null, 4)
                            }, "*");
                        } else if (event.data.url.indexOf("recipes/library/tiddlers/") === 0) {
                            var url = "plugins/" + encodeURIComponent(removePrefix(event.data.url,"recipes/library/tiddlers/"));
                            // Route for recipes/library/tiddlers/<uri-encoded-tiddler-title>.json
                            httpGet(url, function(err, responseText) {
                                if (err) {
                                    event.source.postMessage({
                                        verb: "GET-RESPONSE",
                                        status: "404",
                                        cookies: event.data.cookies,
                                        url: event.data.url,
                                        type: "text/plain",
                                        body: "Not found"
                                    }, "*");
                                } else {
                                    event.source.postMessage({
                                        verb: "GET-RESPONSE",
                                        status: "200",
                                        cookies: event.data.cookies,
                                        url: event.data.url,
                                        type: "application/json",
                                        body: responseText
                                    }, "*");
                                }
                            });
                        } else {
                            event.source.postMessage({
                                verb: "GET-RESPONSE",
                                status: "404",
                                cookies: event.data.cookies,
                                url: event.data.url,
                                type: "text/plain",
                                body: "Not found"
                            }, "*");
                        }
                        break;
                }
            }, false);

            // Helper to remove string prefixes
            function removePrefix(string, prefix) {
                if (string.indexOf(prefix) === 0) {
                    return string.substr(prefix.length);
                } else {
                    return string;
                }
            }

            // Helper for HTTP GET
            function httpGet(url, callback) {
                var http = new XMLHttpRequest();
                http.open("GET", url, true);
                http.onreadystatechange = function() {
                    if (http.readyState == 4 && http.status == 200) {
                        callback(null, http.responseText);
                    }
                };
                http.send();
            }

        }()
    </script>
</head>

<body>
    <h1>HelloThere</h1>
    <p>This is the TiddlyWiki plugin library. It is not intended to be opened directly in the browser.
        See <a href="https://tiddlywiki.com/" target="_blank">https://tiddlywiki.com/</a>
        for details of how to install plugins.</p>
</body>

</html>
